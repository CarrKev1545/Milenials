{% extends "core/base_dashboard_administrativo.html" %}
{% load static %}
{% block title %}Gráficas (ADMIN){% endblock %}

{% block extra_css %}
<style>
  :root{
    --bg-dark:#0b1220; --bg-card:#141c2e; --border:rgba(255,255,255,.08);
    --txt:#e5ecf6; --accent:#9c0f10;
  }
  .gr-wrap{max-width:1100px;margin:0 auto;padding:1rem}
  .gr-filtros{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;margin-bottom:1rem}
  @media (max-width:900px){.gr-filtros{grid-template-columns:1fr}}
  .gr-field{background:var(--bg-card);border:1px solid var(--border);border-radius:.75rem;
            height:3rem;display:flex;align-items:center;padding:0 .75rem;box-shadow:0 .5rem 1rem rgba(0,0,0,.25)}
  .gr-field select{flex:1;border:0;background:transparent;color:var(--txt);font-weight:600;cursor:pointer}
  .gr-card{background:var(--bg-dark);border:1px solid var(--border);border-radius:1rem;padding:1rem;
           color:var(--txt);box-shadow:0 .75rem 1.5rem rgba(0,0,0,.35);margin-bottom:1rem}
  .gr-title{font-weight:800;margin:0 0 .5rem}
  .chart{width:100%;height:clamp(16rem,45vw,24rem)}
</style>
{% endblock %}

{% block page_banner %}
  <div class="admin-bar">Gráficas (BETA)</div>
{% endblock %}

{% block content %}
<section class="gr-wrap">
  <div class="gr-filtros">
    <label class="gr-field">
      <select id="f-sede">
        <option value="">Todas las sedes</option>
      </select>
    </label>
    <label class="gr-field">
      <select id="f-grado" disabled>
        <option value="">Todos los grados</option>
      </select>
    </label>
    <label class="gr-field">
      <select id="f-grupo" disabled>
        <option value="">Todos los grupos</option>
      </select>
    </label>
  </div>

  <article class="gr-card">
    <h3 class="gr-title">Estudiantes activos por sede</h3>
    <div id="chart-activos-sede" class="chart"></div>
  </article>

  <article class="gr-card">
    <h3 class="gr-title">Reprobados por asignatura</h3>
    <div id="chart-reprobados" class="chart"></div>
  </article>
</section>
{% endblock %}

{% block extra_js %}
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  {# <<< URLs del ROL ADMINISTRATIVO >>> #}
  {% url 'api_admin_sedes'               as admin_sedes_url %}
  {% url 'api_admin_grados_por_sede'     as admin_grados_url %}
  {% url 'api_admin_grupos_por_sede_grado' as admin_grupos_url %}
  {% url 'api_metrics_activos'           as api_activos_url %}
  {% url 'api_metrics_reprobados'        as api_reprobados_url %}

  <script>
    window.GR_URLS = {
      api_sedes: "{{ admin_sedes_url|escapejs }}",
      api_grados_por_sede: "{{ admin_grados_url|escapejs }}",
      api_grupos_por_sede_grado: "{{ admin_grupos_url|escapejs }}",
      api_metrics_activos: "{{ api_activos_url|escapejs }}",
      api_metrics_reprobados: "{{ api_reprobados_url|escapejs }}"
    };
  </script>

  {# Usa SOLO este JS (reemplaza el archivo en static) #}
  <script src="{% static 'core/js/graficas_reportes_admin.js' %}"></script>
{% endblock %}

