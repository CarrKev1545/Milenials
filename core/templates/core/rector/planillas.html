{% extends "core/base.html" %}
{% block page_title %}Planillas{% endblock %}

{% block dashboard_content %}
  <h4 class="mb-4">Planillas — Estudiantes activos</h4>

  <p class="text-muted mb-4">Descarga por sede, grado y grupo</p>

  <form method="get" class="row g-3 mb-3">
    <div class="col-12">
      <label class="form-label">Sede</label>
      <select name="sede" class="form-select">
        <option value="">Todas</option>
        {% for id, nombre in sedes %}
          <option value="{{ id }}" {% if sel_sede|stringformat:'s' == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-12">
      <label class="form-label">Grado</label>
      <select name="grado" class="form-select">
        <option value="">Todos</option>
        {% for id, nombre in grados %}
          <option value="{{ id }}" {% if sel_grado|stringformat:'s' == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-12">
      <label class="form-label">Grupo</label>
      <select name="grupo" class="form-select">
        <option value="">Todos</option>
        {% for id, full in grupos %}
          <option value="{{ id }}" {% if sel_grupo|stringformat:'s' == id|stringformat:'s' %}selected{% endif %}>{{ full }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-12 d-flex flex-wrap gap-2 mt-1">
      <button class="btn btn-primary rounded-pill px-4" type="submit">Aplicar filtros</button>

      <!-- OJO: sin namespace para que no falle el reverse en servidor -->
      <a class="btn btn-outline-light rounded-pill px-4" target="_blank"
         href="{% url 'planillas_export_landing' %}?formato=pdf&sede={{ sel_sede }}&grado={{ sel_grado }}&grupo={{ sel_grupo }}">
        Descargar PDF
      </a>

      <a class="btn btn-outline-light rounded-pill px-4" target="_blank"
         href="{% url 'planillas_export_landing' %}?formato=excel&sede={{ sel_sede }}&grado={{ sel_grado }}&grupo={{ sel_grupo }}">
        Descargar Excel
      </a>
    </div>
  </form>

  <p class="text-muted small mb-0">
    Selecciona filtros y usa las opciones de descarga. La exportación se abre en otra pestaña.
  </p>
{% endblock %}