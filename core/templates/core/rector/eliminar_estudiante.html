{% extends "core/base.html" %}
{% block title %}Eliminar estudiantes{% endblock %}

{% block content %}
<div class="container-lg my-4">
  <div class="card shadow-sm bg-dark text-light rounded-3">
    <div class="card-body">

      <h4 class="mb-4">Eliminar Estudiantes</h4>

      <!-- Formulario de búsqueda -->
      <form id="frm-buscar" method="get" class="row g-3 align-items-end">
        <div class="col-12 col-md-8">
          <label class="form-label">Documento del estudiante</label>
          <input id="doc" name="doc" class="form-control"
                 placeholder="Solo dígitos (5–20)"
                 inputmode="numeric" pattern="\d{5,20}"
                 value="{{ request.GET.doc|default_if_none:'' }}">
          <div class="form-text text-secondary">
            Escribe el documento y te mostraremos los datos antes de eliminar.
          </div>
        </div>

        <div class="col-auto">
          <button class="btn btn-primary" type="submit">Buscar</button>
        </div>

        <div class="col-auto">
          <a class="btn btn-outline-light" href="{{ request.path }}">Limpiar</a>
        </div>

        <div class="col-auto">
          <!-- Importante: este botón abre el modal; queda deshabilitado si no hay alumno -->
          <button id="btn-open-confirm" type="button"
                  class="btn btn-danger"
                  data-bs-toggle="modal" data-bs-target="#modalConfirm"
                  {% if not alumno %}disabled{% endif %}>
            Eliminar Estudiante
          </button>
        </div>
      </form>

      {% if alumno %}
      <!-- Resumen del estudiante -->
      <div class="border rounded-3 mt-4 p-3 bg-dark">
        <h6 class="text-muted mb-3">Resumen del estudiante</h6>
        <dl class="row mb-0">
          <dt class="col-sm-3">Nombres:</dt>
          <dd class="col-sm-9">{{ alumno.nombres }}</dd>

          <dt class="col-sm-3">Apellidos:</dt>
          <dd class="col-sm-9">{{ alumno.apellidos }}</dd>

          <dt class="col-sm-3">Documento:</dt>
          <dd class="col-sm-9">{{ alumno.documento }}</dd>

          <dt class="col-sm-3">Sede:</dt>
          <dd class="col-sm-9">{{ alumno.sede }}</dd>

          <dt class="col-sm-3">Grado:</dt>
          <dd class="col-sm-9">{{ alumno.grado }}</dd>

          <dt class="col-sm-3">Grupo:</dt>
          <dd class="col-sm-9">{{ alumno.grupo }}</dd>
        </dl>
      </div>
      {% endif %}

      <!-- Form POST “oculto” para ejecutar el borrado -->
      <form id="frm-delete" action="{% url 'rector_estudiantes_eliminar_do' %}" method="post" class="d-none">
        {% csrf_token %}
        <input type="hidden" name="doc" id="doc-hidden" value="{{ alumno.documento|default:'' }}">
      </form>

      <!-- Modal de confirmación -->
      <div class="modal fade" id="modalConfirm" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content bg-dark text-light border-0">
            <div class="modal-header border-0">
              <h5 class="modal-title">Confirmar eliminación</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <p class="mb-2">
                Al borrar este estudiante se eliminarán <strong>todas</strong> sus notas e historial de notas.
              </p>
              {% if alumno %}
              <p class="mb-0">
                ¿Seguro que deseas eliminar a
                <strong id="alumno-nombre">{{ alumno.apellidos }} {{ alumno.nombres }}</strong>
                (doc. <span id="alumno-doc">{{ alumno.documento }}</span>)?
              </p>
              {% endif %}
            </div>
            <div class="modal-footer border-0">
              <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancelar</button>
              <button id="btn-confirm-delete" type="button" class="btn btn-danger">Sí, eliminar</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
(function() {
  const btnConfirm = document.getElementById('btn-confirm-delete');
  if (btnConfirm) {
    btnConfirm.addEventListener('click', function () {
      document.getElementById('frm-delete').submit();
    });
  }
})();
</script>
{% endblock %}

