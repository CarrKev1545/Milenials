{% extends "core/base.html" %}
{% load static %}

{% block title %}¿Olvidaste tu contraseña?{% endblock %}

{% block extra_css %}
<style>
  :root{
    --bg:#0b1220;
    --plate-from:#0c0c0c;
    --plate-to:#121622;
    --ink:#0f172a;
    --text:#e5ecf6;
    --muted:#cbd5e1;
    --border:rgba(255,255,255,.10);
    --accent:#c62828;
    --accent-shadow:rgba(156,15,16,.45);

    /* posiciones del destello (se actualizan por JS) */
    --mx: 50%;
    --my: 35%;
  }

  html, body { height:100%; background:#000; }
  body { margin:0; }

  /* Lienzo de fondo: full-bleed + capas con aura y viñeta */
  .fp{
    position:fixed; inset:0;
    display:grid; place-items:center;
    overflow:auto;
    isolation:isolate; /* aísla blend del glow */
    background:
      /* halo rojo alto */
      radial-gradient(1400px 700px at 80% -10%, rgba(198,40,40,.30), transparent 60%),
      /* halo verde bajo */
      radial-gradient(1100px 600px at 0% 100%, rgba(19,111,54,.22), transparent 62%),
      /* baño morado muy tenue para profundizar */
      radial-gradient(1800px 1200px at 50% 20%, rgba(88,80,180,.12), transparent 65%),
      /* gradiente base */
      linear-gradient(180deg, var(--plate-from), var(--plate-to));
    animation: slow-pan 22s linear infinite;
  }
  /* viñeta elegante alrededor del viewport */
  .fp::before{
    content:"";
    position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(closest-corner at 50% 50%,
        transparent 60%,
        rgba(0,0,0,.12) 80%,
        rgba(0,0,0,.25) 100%);
    z-index:0;
  }
  /* Destello que sigue el cursor (más grande e intenso) */
  .fp::after{
    content:"";
    position:fixed; inset:0; pointer-events:none;
    background:
      /* halo principal */
      radial-gradient( 780px 780px at var(--mx) var(--my),
        rgba(255,255,255,.16) 0%,
        rgba(255,255,255,.10) 28%,
        rgba(255,255,255,.05) 48%,
        transparent 70%),
      /* hotspot pequeño para un “bloom” bonito */
      radial-gradient( 220px 220px at calc(var(--mx) + 2%) calc(var(--my) - 1%),
        rgba(255,255,255,.22) 0%,
        rgba(255,255,255,.10) 45%,
        transparent 70%);
    mix-blend-mode: screen;
    transition: background-position .10s ease;
    z-index:1;
  }

  @keyframes slow-pan{
    0%   { background-position: 0px 0px, 0px 0px, 0px 0px, 0 0; }
    50%  { background-position: 24px -12px, -24px 18px, 10px -8px, 0 0; }
    100% { background-position: 0px 0px, 0px 0px, 0px 0px, 0 0; }
  }

  /* Backplate más borroso y con brillo suave */
  .fp-wrap{
    position:relative;
    width:min(44rem, 92vw);
    padding:1.25rem;
    z-index:2;
  }
  .fp-wrap::before{
    content:"";
    position:absolute; inset:-1.25rem;
    border-radius:1.35rem;
    background:
      linear-gradient(180deg, rgba(12,12,12,.70), rgba(12,12,12,.86));
    border:1px solid var(--border);
    box-shadow:
      0 1.3rem 2.4rem rgba(0,0,0,.50),
      0 0 2.2rem rgba(255,255,255,.05) inset;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index:0;
  }

  /* Tarjeta (glass más definido) */
  .fp-card{
    position:relative; z-index:1;
    color:var(--text);
    background:linear-gradient(180deg, rgba(9,16,32,.78), rgba(9,16,32,.92));
    border:1px solid rgba(255,255,255,.12);
    border-radius:1rem;
    padding:1.35rem 1.35rem 1.1rem;
    box-shadow:
      0 .9rem 1.7rem rgba(0,0,0,.48),
      0 0 .35rem rgba(255,255,255,.08) inset;
    backdrop-filter: blur(12px) saturate(1.02);
    -webkit-backdrop-filter: blur(12px) saturate(1.02);
  }

  /* Badge */
  .fp-badge{
    position:absolute; left:50%; top:0; transform:translate(-50%,-55%);
    background:var(--accent); color:#fff; font-weight:800;
    padding:.8rem 1.6rem; border-radius:999rem; letter-spacing:.3px;
    box-shadow:
      0 .9rem 1.5rem var(--accent-shadow),
      0 0 0 .22rem rgba(255,255,255,.06) inset;
    white-space:nowrap;
  }

  .fp-head{ margin-top:.7rem; text-align:center; }
  .fp-title{ margin:0; font-weight:800; font-size:1.35rem; }
  .fp-sub{ margin:.35rem 0 1.1rem; color:var(--muted); font-size:.97rem; }

  .fp-messages .alert{
    border-radius:.8rem; border:1px solid var(--border);
    padding:.65rem .8rem; margin-bottom:.75rem;
  }

  .fp-field{
    position:relative; display:flex; align-items:center;
    height:3.25rem; border-radius:.95rem; background:#fff;
    border:1px solid rgba(0,0,0,.08);
    box-shadow:0 .65rem 1.3rem rgba(0,0,0,.22), inset 0 .06rem .22rem rgba(0,0,0,.06);
    padding:0 .95rem 0 3rem;
    transition: box-shadow .15s ease, border-color .15s ease, transform .08s ease;
  }
  .fp-ico{
    position:absolute; left:.95rem; top:50%; transform:translateY(-50%);
    color:var(--ink); opacity:.85;
  }
  .fp-field input{
    border:0; outline:0; background:transparent; width:100%;
    font-weight:700; color:var(--ink); font-size:1.02rem;
  }
  .fp-field:has(input:focus-visible){
    box-shadow:0 0 0 .22rem rgba(198,40,40,.18), 0 .65rem 1.3rem rgba(0,0,0,.22);
    border-color: rgba(198,40,40,.36);
    transform: translateY(-1px);
  }
  .fp-help{ color:var(--muted); font-size:.92rem; margin:.45rem 0 0; }

  .fp-actions{ display:grid; grid-template-columns:1fr 1fr; gap:.8rem; margin-top:1.1rem; }
  @media (max-width:560px){ .fp-actions{ grid-template-columns:1fr; } }

  .btn-pill{
    height:3rem; border-radius:999rem; font-weight:800;
    border:1px solid var(--border); color:#fff; cursor:pointer;
    transition: transform .12s ease, filter .15s ease;
  }
  .btn-primary{
    background: var(--accent);
    box-shadow:0 .8rem 1.6rem var(--accent-shadow), inset 0 -.18rem .55rem rgba(0,0,0,.18);
  }
  .btn-ghost{
    background:#374151;
    box-shadow:0 .8rem 1.6rem rgba(0,0,0,.28), inset 0 -.18rem .55rem rgba(0,0,0,.18);
    text-align:center; display:inline-grid; place-items:center; text-decoration:none;
  }
  .btn-pill:hover{ transform:translateY(-1px); filter:saturate(1.05); }

  .fp-foot{ margin-top:1rem; color:var(--muted); font-size:.88rem; text-align:center; }

  /* Respeto accesibilidad */
  @media (prefers-reduced-motion: reduce){
    .fp{ animation:none; }
    .fp::after{
      background:
        radial-gradient(700px 700px at 50% 35%,
          rgba(255,255,255,.12) 0%,
          rgba(255,255,255,.06) 35%,
          transparent 62%);
    }
  }
</style>
{% endblock %}

{% block content %}
<section class="fp">
  <div class="fp-wrap">
    <div class="fp-card">
      <div class="fp-badge">Recuperar acceso</div>

      <header class="fp-head" aria-labelledby="fp-title">
        <h1 id="fp-title" class="fp-title">¿Olvidaste tu contraseña?</h1>
        <p class="fp-sub">Ingresa el correo que usas para iniciar sesión. Te enviaremos un enlace para restablecerla.</p>
      </header>

      <div class="fp-messages">
        {% if messages %}
          {% for m in messages %}
            <div class="alert alert-{{ m.tags }}">{{ m }}</div>
          {% endfor %}
        {% endif %}
      </div>

      <form method="post" novalidate>
        {% csrf_token %}
        <label class="fp-field" for="email">
          <span class="fp-ico"><i class="fa-solid fa-envelope"></i></span>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="tucorreo@dominio.com"
            required
            autocomplete="email"
            inputmode="email"
          >
        </label>
        <p id="hint-email" class="fp-help">Verifica que sea tu correo institucional si aplica.</p>

        <div class="fp-actions">
          <button type="submit" class="btn-pill btn-primary">Enviar</button>
          <a href="{% url 'login' %}" class="btn-pill btn-ghost">Volver al inicio</a>
        </div>
      </form>

      <p class="fp-foot">
        ¿No recibiste el correo? Revisa tu carpeta de spam o inténtalo nuevamente en un par de minutos.
      </p>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  // Solo visual: actualiza la posición del glow.
  (function () {
    const root = document.documentElement;
    function update(e){
      const x = (e.clientX / window.innerWidth ) * 100;
      const y = (e.clientY / window.innerHeight) * 100;
      root.style.setProperty('--mx', x + '%');
      root.style.setProperty('--my', y + '%');
    }
    window.addEventListener('mousemove', update, { passive:true });
    update({ clientX: innerWidth*0.5, clientY: innerHeight*0.35 });
  })();
</script>
{% endblock %}
