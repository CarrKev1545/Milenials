{% extends "core/base_dashboard_docente.html" %}
{% block title %}Planillas - Docente{% endblock %}

{% block extra_css %}
<style>
  /* ===== Variables y escala (igual al rector) ===== */
  :root{
    font-size:16.5px;
    --bg-dark:#0b1220;
    --fg-light:#e5ecf6;
    --ink:#111;
    --border-light:rgba(255,255,255,.08);
    --shadow-deep:rgba(0,0,0,.35);
    --shadow-deeper:rgba(0,0,0,.45);
    --field-border:rgba(0,0,0,.06);
    --field-shadow:rgba(0,0,0,.22);
    --accent:#c62828;
    --accent-shadow:rgba(156,15,16,.35);
  }
  @media (max-width:75em){ :root{font-size:16px} }
  @media (max-width:62em){ :root{font-size:15.5px} }
  @media (max-width:48em){ :root{font-size:15px} }
  @media (max-width:36em){ :root{font-size:14px} }

  /* ===== Layout base de esta vista ===== */
  .main{ display:block; padding:1.25rem; }
  .main > h1.mb-3{
    position:absolute; left:50%; top:0; transform:translate(-50%,-50%);
    margin:0; background:var(--accent); color:#fff; font-weight:800;
    padding:.85rem 1.95rem; border-radius:1rem; letter-spacing:.35px;
    text-shadow:0 1px 0 rgba(0,0,0,.25);
    box-shadow:0 .9rem 1.5rem var(--shadow-deeper), inset 0 -.3rem .7rem rgba(0,0,0,.18);
    z-index:3; white-space:nowrap;
  }

  /* ===== Tarjeta/Backplate alrededor del <form> ===== */
  .main form.row.g-2{
    position:relative;
    width:min(58rem, 92vw);
    margin:3.75rem auto 0;        /* deja espacio al badge */
    padding:1.35rem;
    color:var(--fg-light);
    background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.35));
    border:1px solid var(--border-light);
    border-radius:1.1rem;
    box-shadow:0 1rem 1.9rem var(--shadow-deep), inset 0 .02rem .35rem rgba(255,255,255,.04);
    backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
    z-index:2;
  }
  .main form.row.g-2::before{
    content:""; position:absolute; inset:-2rem;
    border-radius:1.6rem; z-index:-1;
    background:linear-gradient(180deg, rgba(12,12,12,.70), rgba(12,12,12,.84));
    border:1px solid var(--border-light);
    box-shadow:0 1.6rem 2.6rem var(--shadow-deeper), inset 0 .06rem .55rem rgba(255,255,255,.04);
    backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
  }

  /* ===== Campos (etiqueta + select) ===== */
  .main .form-label{
    display:block; font-weight:800; color:#cbd5e1; margin:.15rem .25rem .45rem;
  }
  .main .form-select{
    height:3.9rem; border-radius:.95rem; background:#fff; color:var(--ink);
    border:1px solid var(--field-border);
    box-shadow:0 .65rem 1.3rem var(--field-shadow), inset 0 .06rem .22rem rgba(0,0,0,.06);
    padding:.625rem .95rem .625rem 3rem; font-weight:700; font-size:1.03rem;
    appearance:none; position:relative;
  }
  /* caret custom */
  .main .form-select:not([multiple]){
    background-image:linear-gradient(45deg, transparent 50%, #555 50%),
                     linear-gradient(135deg, #555 50%, transparent 50%);
    background-position: calc(100% - 1.05rem) 1.35rem, calc(100% - .65rem) 1.35rem;
    background-size:.45rem .45rem, .45rem .45rem;
    background-repeat:no-repeat;
  }
  /* icono izquierda */
  .main .col-md-3{ position:relative; }
  .main .col-md-3::before{
    content:"\f03a"; /* fa-table por defecto */
    font: normal 900 1.08rem/1 "Font Awesome 6 Free";
    position:absolute; left:1.05rem; top:calc(2.25rem + .95rem); color:#111; opacity:.9;
    pointer-events:none;
  }
  /* focus rojo del patrÃ³n */
  .main .form-select:focus{
    border-color:rgba(198,40,40,.36);
    box-shadow:0 0 0 .24rem rgba(198,40,40,.18), 0 .7rem 1.35rem var(--field-shadow);
  }

  /* ===== Acciones ===== */
  .main .d-flex.align-items-end.gap-2{ margin-top:.25rem; }
  .main .btn{
    height:3rem; border-radius:999rem; border:1px solid var(--border-light);
    font-weight:800; font-size:1rem; color:#fff; padding:0 1.25rem;
    transition: transform .12s ease, box-shadow .15s ease, filter .15s ease;
  }
  .main .btn-outline-danger{
    background:var(--accent); border-color:transparent !important;
    box-shadow:0 .8rem 1.6rem var(--accent-shadow), inset 0 -.18rem .55rem rgba(0,0,0,.18);
  }
  .main .btn-outline-success{
    background:#136f36; border-color:transparent !important;
    box-shadow:0 .8rem 1.6rem rgba(19,111,54,.32), inset 0 -.18rem .55rem rgba(0,0,0,.18);
  }
  .main .btn:hover{ transform:translateY(-.06rem); filter:saturate(1.06) brightness(1.02); }
  .main .btn:active{ transform:translateY(.02rem); }

  /* ===== Responsive ===== */
  @media (max-width:48em){
    .main > h1.mb-3{ transform:translate(-50%,-85%); }
    .main form.row.g-2{ margin-top:3.25rem; }
    .main form.row.g-2::before{ inset:-1.25rem; }
  }

  @media (prefers-reduced-motion: reduce){
    .main .form-select, .main .btn{ transition:none !important; }
  }
</style>
{% endblock %}

{% block content %}
<main class="main">
  <h1 class="mb-3">Planillas</h1>

  {# ðŸ‘‰ El form ahora apunta al INDEX, NO al landing #}
  <form method="get" action="{% url 'docente_planillas_index' %}" class="row g-2" autocomplete="off" novalidate>
    <div class="col-md-3">
      <label class="form-label" for="f_sede">Sede</label>
      <select id="f_sede" name="sede" class="form-select" onchange="this.form.submit()">
        <option value="">Todas</option>
        {% for id, nombre in sedes %}
          <option value="{{ id }}" {% if sel_sede == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label" for="f_grado">Grado</label>
      <select id="f_grado" name="grado" class="form-select" onchange="this.form.submit()">
        <option value="">Todos</option>
        {% for id, nombre in grados %}
          <option value="{{ id }}" {% if sel_grado == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label" for="f_grupo">Grupo</label>
      <select id="f_grupo" name="grupo" class="form-select">
        <option value="">Todos</option>
        {% for id, label in grupos %}
          <option value="{{ id }}" {% if sel_grupo == id|stringformat:'s' %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3 d-flex align-items-end gap-2">
      {# ðŸ‘‰ Los botones sÃ­ van al landing y abren en otra pestaÃ±a #}
      <button class="btn btn-outline-danger"
              type="submit"
              name="formato" value="pdf"
              formaction="{% url 'docente_planillas_export_landing' %}"
              formtarget="_blank">
        PDF
      </button>

      <button class="btn btn-outline-success"
              type="submit"
              name="formato" value="excel"
              formaction="{% url 'docente_planillas_export_landing' %}"
              formtarget="_blank">
        Excel
      </button>
    </div>
  </form>
</main>
{% endblock %}

{% block extra_js %}
<script>
  // Deja solo el nÃºmero del grupo en el combo (p.ej. "1101")
  (function () {
    const sel = document.getElementById('f_grupo');
    if (!sel) return;

    Array.from(sel.options).forEach(opt => {
      if (!opt.value) return;                 // deja "Todos"
      const txt = (opt.textContent || '').trim();
      const parts = txt.split(' - ');         // "Sede Secundaria - 11Â° - 1101"
      const last = parts[parts.length - 1];   // "1101"
      if (last) opt.textContent = last.trim();
    });
  })();
</script>
{% endblock %}