{% extends "core/base_dashboard_docente.html" %}
{% load static %}

{% block title %}Planillas - Docente{% endblock %}

{% block extra_css %}
<style>
  /* ====== BASE VISUAL (solo presentación) ====== */
  :root{
    font-size:16.5px;
    --bg-dark:#0b1220;
    --fg-light:#e5ecf6;
    --ink:#101114;
    --border-light:rgba(255,255,255,.08);
    --shadow-deep:rgba(0,0,0,.35);
    --shadow-deeper:rgba(0,0,0,.45);
    --field-border:rgba(0,0,0,.08);
    --field-shadow:rgba(0,0,0,.20);
    --accent:#c62828;                    /* rojo principal (PDF/Badge) */
    --accent-shadow:rgba(156,15,16,.35);
    --success:#136f36;                   /* verde Excel */
    --success-shadow:rgba(19,111,54,.32);
  }
  @media (max-width:75em){ :root{font-size:16px} }
  @media (max-width:62em){ :root{font-size:15.5px} }
  @media (max-width:48em){ :root{font-size:15px} }
  @media (max-width:36em){ :root{font-size:14px} }

  /* Suaviza tipografía y bordes */
  .pl, .pl *{
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    text-rendering:optimizeLegibility;
  }

  /* ====== LAYOUT ====== */
  .pl{ width:100%; max-width:58rem; margin:0 auto; padding:1.25rem; }

  .pl-wrap{ position:relative; padding-top:4.25rem; }
  .pl-wrap::before{
    content:"";
    position:absolute;
    top:-3.25rem; right:-2rem; bottom:-2rem; left:-2rem;
    border-radius:1.6rem;
    /* glass + leve vignette para separar del bg */
    background:
      radial-gradient(120% 80% at 50% -10%, rgba(255,255,255,.06), transparent 60%),
      linear-gradient(180deg, rgba(16,16,18,.72), rgba(16,16,18,.86));
    border:1px solid var(--border-light);
    box-shadow:
      0 1.6rem 2.6rem var(--shadow-deeper),
      inset 0 .06rem .55rem rgba(255,255,255,.045);
    z-index:0;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }

  .pl-card{
    position:relative; z-index:1; color:var(--fg-light);
    background:linear-gradient(180deg, rgba(0,0,0,.34), rgba(0,0,0,.36));
    border:1px solid var(--border-light);
    border-radius:1.1rem;
    box-shadow:
      0 1rem 1.9rem var(--shadow-deep),
      inset 0 .02rem .35rem rgba(255,255,255,.04);
    padding:1.35rem;
    backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
  }

  /* ====== FORM GRID ====== */
  .pl-form{ display:grid; gap:1.15rem; grid-template-columns:1fr; }
  @media (min-width:56.25em){ .pl-form{ grid-template-columns:repeat(2,1fr); } }
  .pl-field--span-2{ grid-column:1 / -1; }

  /* ====== FIELDS (select pill blanco) ====== */
  .pl-field{
    position:relative; display:flex; align-items:center;
    height:3.9rem; border-radius:.95rem;
    background:#fff; border:1px solid var(--field-border);
    padding:0 .95rem 0 3rem;
    box-shadow:0 .65rem 1.15rem var(--field-shadow),
               inset 0 .06rem .22rem rgba(0,0,0,.06);
    transition: box-shadow .15s ease, border-color .15s ease, transform .12s ease;
  }
  .pl-field:hover{
    box-shadow:0 .75rem 1.25rem var(--field-shadow),
               inset 0 .06rem .22rem rgba(0,0,0,.06);
  }
  .pl-ico{
    position:absolute; left:.95rem; top:50%; transform:translateY(-50%);
    color:var(--ink); opacity:.9; font-size:1.08rem;
  }
  .pl-field select{
    width:100%; border:0; outline:none; background:transparent;
    font-weight:700; color:var(--ink); font-size:1.03rem;
    appearance:none; -moz-appearance:none; -webkit-appearance:none;
  }
  /* Focus accesible (ring rojo suave) */
  .pl-field:has(select:focus-visible){
    box-shadow:
      0 0 0 .22rem rgba(198,40,40,.18),
      0 .75rem 1.25rem var(--field-shadow);
    border-color:rgba(198,40,40,.36);
  }
  /* Chevron consistente (sin salto de layout) */
  .pl-field::after{
    content:""; position:absolute; right:.9rem; top:50%; transform:translateY(-50%);
    width:.55rem; height:.55rem; border-right:2px solid var(--ink); border-bottom:2px solid var(--ink);
    opacity:.7; rotate:45deg; pointer-events:none;
  }
  /* Firefox padding fix */
  @-moz-document url-prefix() {
    .pl-field select{ padding-top:.05rem; }
  }

  /* ====== ACTIONS ====== */
  .pl-actions{ display:grid; gap:.9rem; grid-template-columns:1fr; margin-top:.9rem; }
  @media (min-width:33.75em){ .pl-actions{ grid-template-columns:repeat(2,1fr);} }
  .pl-actions .btn{
    height:3.15rem; border-radius:999rem; border:1px solid var(--border-light);
    font-weight:800; font-size:1.02rem; color:#fff;
    transition: transform .12s ease, box-shadow .16s ease, filter .15s ease, opacity .15s ease;
    will-change: transform;
  }
  .btn-pdf{
    background:var(--accent);
    box-shadow:0 .9rem 1.6rem var(--accent-shadow), inset 0 -.18rem .55rem rgba(0,0,0,.18);
  }
  .btn-xls{
    background:var(--success);
    box-shadow:0 .9rem 1.6rem var(--success-shadow), inset 0 -.18rem .55rem rgba(0,0,0,.18);
  }
  .pl-actions .btn:hover{ transform:translateY(-.06rem); filter:saturate(1.06) brightness(1.02); }
  .pl-actions .btn:active{ transform:translateY(.02rem); filter:saturate(1.02); }
  .pl-actions .btn:disabled{ opacity:.7; cursor:not-allowed; }

  /* ====== BADGE ====== */
  .pl-badge{
    position:absolute; left:50%; top:0; transform:translate(-50%,-45%);
    display:inline-block; color:#fff; white-space:nowrap; z-index:2;
    padding:.9rem 2rem; border-radius:1rem; font-weight:800; font-size:1.24rem; letter-spacing:.35px;
    background:linear-gradient(180deg, #d23333 0%, #b32323 100%);
    box-shadow:0 .9rem 1.5rem var(--shadow-deeper), inset 0 -.3rem .7rem rgba(0,0,0,.18);
    text-shadow:0 1px 0 rgba(0,0,0,.25);
  }

  /* ====== CENTRADO VERTICAL ROBUSTO ====== */
  .pl{
    min-height:74vh;
    display:grid;
    place-items:center;
    padding-top:10vh;
    padding-bottom:10vh;
  }
  .pl-wrap{ width:100%; }

  @media (max-height:680px){
    .pl{ min-height:auto; padding-top:5vh; padding-bottom:6vh; }
  }
  @media (min-height:820px){
    .pl{ min-height:80vh; padding-top:12vh; padding-bottom:12vh; }
  }

  /* ====== ACCESIBILIDAD / PREFERENCIAS ====== */
  @media (prefers-reduced-motion: reduce){
    .pl-field, .pl-actions .btn { transition:none !important; }
  }
  /* Selección de texto agradable */
  ::selection{ background:rgba(198,40,40,.28); color:#fff; }
</style>
{% endblock %}

{% block content %}
<section class="pl" aria-labelledby="titulo-pl">
  <div class="pl-wrap">
    <div id="titulo-pl" class="pl-badge">Planillas</div>

    <div class="pl-card" role="group" aria-label="Filtros de exportación">
      {# 👉 Misma lógica: GET al index y onchange en sede/grado #}
      <form method="get"
            action="{% url 'docente_planillas_index' %}"
            class="pl-form"
            autocomplete="off" novalidate>

        <!-- Sede -->
        <label class="pl-field" for="f_sede">
          <span class="pl-ico"><i class="fa-solid fa-building-columns"></i></span>
          <select id="f_sede" name="sede" onchange="this.form.submit()">
            <option value="">Sedes</option>
            {% for id, nombre in sedes %}
              <option value="{{ id }}" {% if sel_sede == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- Grado -->
        <label class="pl-field" for="f_grado">
          <span class="pl-ico"><i class="fa-solid fa-layer-group"></i></span>
          <select id="f_grado" name="grado" onchange="this.form.submit()">
            <option value="">Grados</option>
            {% for id, nombre in grados %}
              <option value="{{ id }}" {% if sel_grado == id|stringformat:'s' %}selected{% endif %}>{{ nombre }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- Grupo (full width) -->
        <label class="pl-field pl-field--span-2" for="f_grupo">
          <span class="pl-ico"><i class="fa-solid fa-people-group"></i></span>
          <select id="f_grupo" name="grupo">
            <option value="">Grupos</option>
            {% for id, label in grupos %}
              <option value="{{ id }}" {% if sel_grupo == id|stringformat:'s' %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- Acciones -->
        <div class="pl-actions">
          <button class="btn btn-pdf"
                  type="submit"
                  name="formato" value="pdf"
                  formaction="{% url 'docente_planillas_export_landing' %}"
                  formtarget="_blank">
            Descargar PDF
          </button>

          <button class="btn btn-xls"
                  type="submit"
                  name="formato" value="excel"
                  formaction="{% url 'docente_planillas_export_landing' %}"
                  formtarget="_blank">
            Descargar Excel
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  // Misma lógica: mostrar solo el código del grupo (p.ej., "1101")
  (function () {
    const sel = document.getElementById('f_grupo');
    if (!sel) return;
    Array.from(sel.options).forEach(opt => {
      if (!opt.value) return; // placeholder "Grupos"
      const txt = (opt.textContent || '').trim();
      const parts = txt.split(' - ');         // "Sede X - 11° - 1101"
      const last = parts[parts.length - 1];   // "1101"
      if (last) opt.textContent = last.trim();
    });
  })();
</script>
{% endblock %}
